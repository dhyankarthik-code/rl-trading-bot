<!DOCTYPE html>
<html                     <button class="btn btn-outline-primary" onclick="addChart()">Add Chart</button>
                    <button class="btn btn-outline-danger" onclick="getPrediction()">Get Prediction</button>
                    <button class="btn btn-outline-secondary" onclick="saveLayout()">Save Layout</button>ng="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supercharts Workspace</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Left Toolbar -->
            <div class="col-md-2 bg-secondary text-white p-3">
                <h5>Drawing Tools</h5>
                <button class="btn btn-light btn-sm mb-1" onclick="addTrendLine()">Trend Line</button><br>
                <button class="btn btn-light btn-sm mb-1" onclick="addHorizontal()">Horizontal (Alt+H)</button><br>
                <button class="btn btn-light btn-sm mb-1" onclick="addVertical()">Vertical (Alt+V)</button><br>
                <button class="btn btn-light btn-sm mb-1" onclick="addRectangle()">Rectangle</button><br>
                <button class="btn btn-light btn-sm mb-1" onclick="addFib()">Fib Retracement</button><br>
                <button class="btn btn-light btn-sm mb-1" onclick="addText()">Text</button><br>
                <h5>Indicators</h5>
                <button class="btn btn-info btn-sm mb-1" onclick="addMA()">MA</button><br>
                <button class="btn btn-info btn-sm mb-1" onclick="addRSI()">RSI</button><br>
                <button class="btn btn-info btn-sm mb-1" onclick="addMACD()">MACD</button><br>
                <button class="btn btn-info btn-sm mb-1" onclick="addBOS()">BOS (Smart Money)</button><br>
                <button class="btn btn-info btn-sm mb-1" onclick="addDivergence()">RSI Divergence</button><br>
                <h5>Risk Tools</h5>
                <button class="btn btn-warning btn-sm" onclick="calcPosition()">Calc Position</button>
            </div>

            <!-- Main Content -->
            <div class="col-md-7">
                <!-- Multi-Tab -->
                <ul class="nav nav-tabs" id="chartTabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="#tab1">Chart 1</a>
                    </li>
                </ul>
                <div class="tab-content" id="chartContent">
                    <div class="tab-pane active" id="tab1">
                        <div class="row" id="grid1">
                            <div class="col-12">
                                <div id="chart1" style="height: 400px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="col-md-3 bg-light p-3">
                <h5>Watchlists</h5>
                <input type="text" class="form-control mb-2" placeholder="Filter..." id="watchlistFilter">
                <div id="watchlists">
                    <div class="watchlist-section" draggable="true">
                        <h6>Stocks <span class="badge bg-primary">3</span></h6>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-center" style="color: green;">
                                AAPL <span class="badge bg-success">Buy</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" style="color: red;">
                                GOOGL <span class="badge bg-danger">Sell</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" style="color: blue;">
                                MSFT <span class="badge bg-info">Hold</span>
                            </li>
                        </ul>
                        <div class="subfolder mt-2">
                            <h6>Tech Sub <span class="badge bg-secondary">2</span></h6>
                            <ul class="list-group">
                                <li class="list-group-item">AAPL - Analysis 1</li>
                                <li class="list-group-item">GOOGL - Analysis 2</li>
                            </ul>
                        </div>
                    </div>
                    <div class="watchlist-section" draggable="true">
                        <h6>Crypto <span class="badge bg-warning">1</span></h6>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-center" style="color: orange;">
                                BTC-USD <span class="badge bg-warning">Watch</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <button class="btn btn-sm btn-primary mt-2" onclick="addToWatchlist()">Add Symbol</button>
                <h5 class="mt-3">Object Tree</h5>
                <div id="objectTree">
                    <div class="folder" onclick="toggleFolder('drawings')">Drawings <span>▶</span></div>
                    <div id="drawings" class="folder-content" style="display:none;">
                        <div class="object-item" onclick="selectObject('trend1')">Trend Line 1</div>
                        <div class="object-item" onclick="selectObject('horiz1')">Horizontal 1</div>
                    </div>
                    <div class="folder" onclick="toggleFolder('indicators')">Indicators <span>▶</span></div>
                    <div id="indicators" class="folder-content" style="display:none;">
                        <div class="object-item" onclick="selectObject('ma20')">MA(20)</div>
                        <div class="object-item" onclick="selectObject('rsi')">RSI</div>
                    </div>
                </div>
                <button class="btn btn-sm btn-secondary mt-2" onclick="hideSelected()">Hide</button>
                <button class="btn btn-sm btn-danger mt-2" onclick="deleteSelected()">Delete</button>
                <button class="btn btn-sm btn-warning mt-2" onclick="undo()">Undo (Ctrl+Z)</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let chartCount = 1;
        let layouts = JSON.parse(localStorage.getItem('layouts') || '{}');

        function addChart() {
            chartCount++;
            const tabId = `tab${chartCount}`;
            const chartId = `chart${chartCount}`;
            // Add tab
            document.getElementById('chartTabs').innerHTML += `<li class="nav-item"><a class="nav-link" href="#${tabId}">Chart ${chartCount}</a></li>`;
            // Add content
            document.getElementById('chartContent').innerHTML += `
                <div class="tab-pane" id="${tabId}">
                    <div class="row" id="grid${chartCount}">
                        <div class="col-12">
                            <div id="${chartId}" style="height: 400px;"></div>
                        </div>
                    </div>
                </div>
            `;
            // Init chart
            Plotly.newPlot(chartId, [{x: [1,2,3], y: [1,2,3], type: 'scatter'}]);
        }

        function changeGrid() {
            const size = document.getElementById('gridSize').value;
            // Placeholder: Adjust grid classes
            alert(`Grid changed to ${size} (placeholder)`);
        }

        function getPrediction() {
            const symbol = document.getElementById('symbol').value;
            fetch(`http://localhost:8000/predict`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ticker: symbol})
            })
            .then(response => response.json())
            .then(data => {
                // Overlay SHAP on chart
                const annotation = {
                    text: `Action: ${data.action} (0:Sell,1:Hold,2:Buy)<br>SHAP: ${data.explanation}`,
                    x: 0.5,
                    y: 0.5,
                    xref: 'paper',
                    yref: 'paper',
                    showarrow: false
                };
                Plotly.relayout('chart1', {annotations: [annotation]});
                alert(`Prediction: ${data.action}`);
            })
            .catch(error => console.error('Error:', error));
        }

        // Event listeners
        document.getElementById('symbol').addEventListener('change', syncCharts);
        document.getElementById('timeframe').addEventListener('change', syncCharts);
        document.getElementById('gridSize').addEventListener('change', changeGrid);

        function saveLayout() {
            const layout = {
                charts: chartCount,
                symbol: document.getElementById('symbol').value,
                timeframe: document.getElementById('timeframe').value,
                gridSize: document.getElementById('gridSize').value
            };
            localStorage.setItem('currentLayout', JSON.stringify(layout));
            alert('Layout saved');
        }

        function loadLayout() {
            const layout = JSON.parse(localStorage.getItem('currentLayout') || '{}');
            if (layout.symbol) document.getElementById('symbol').value = layout.symbol;
            if (layout.timeframe) document.getElementById('timeframe').value = layout.timeframe;
            if (layout.gridSize) document.getElementById('gridSize').value = layout.gridSize;
            // Recreate charts if needed
            alert('Layout loaded');
        }

        // Drawing functions
        function addTrendLine() {
            const shape = {
                type: 'line',
                x0: 1, y0: 1, x1: 3, y1: 3,
                line: {color: 'red', width: 2}
            };
            Plotly.relayout('chart1', {shapes: [shape]});
        }

        function addHorizontal() {
            const shape = {
                type: 'line',
                x0: 0, y0: 2, x1: 1, y1: 2,
                xref: 'paper',
                line: {color: 'blue', width: 2}
            };
            Plotly.relayout('chart1', {shapes: [shape]});
        }

        function addVertical() {
            const shape = {
                type: 'line',
                x0: 2, y0: 0, x1: 2, y1: 1,
                yref: 'paper',
                line: {color: 'green', width: 2}
            };
            Plotly.relayout('chart1', {shapes: [shape]});
        }

        function addRectangle() {
            const shape = {
                type: 'rect',
                x0: 1, y0: 1, x1: 2, y1: 2,
                fillcolor: 'rgba(255,0,0,0.2)',
                line: {width: 1}
            };
            Plotly.relayout('chart1', {shapes: [shape]});
        }

        function addFib() {
            // Placeholder: Add Fib levels
            alert('Fib Retracement added (placeholder)');
        }

        function addText() {
            const annotation = {
                text: 'Sample Text',
                x: 2, y: 2,
                showarrow: false
            };
            Plotly.relayout('chart1', {annotations: [annotation]});
        }

        function addMA() {
            const maTrace = {
                x: [1,2,3,4],
                y: [1.5,2.5,2.5,3.5],
                type: 'scatter',
                name: 'MA(20)',
                line: {color: 'orange'}
            };
            Plotly.addTraces('chart1', maTrace);
        }

        function addRSI() {
            // Add subplot for RSI
            alert('RSI added as subplot (placeholder)');
        }

        function addMACD() {
            alert('MACD added (placeholder)');
        }

        function addBOS() {
            // Smart Money BOS: Break of Structure
            const bosAnnotation = {
                text: 'BOS Detected',
                x: 2.5, y: 2.5,
                showarrow: true,
                arrowhead: 2
            };
            Plotly.relayout('chart1', {annotations: [bosAnnotation]});
        }

        function addDivergence() {
            // RSI Divergence
            alert('RSI Divergence highlighted (placeholder)');
        }

        let selectedObject = null;
        let history = [];

        function toggleFolder(id) {
            const el = document.getElementById(id);
            el.style.display = el.style.display === 'none' ? 'block' : 'none';
        }

        function selectObject(obj) {
            selectedObject = obj;
            alert(`Selected: ${obj}`);
        }

        function hideSelected() {
            if (selectedObject) {
                // Placeholder: Hide object
                alert(`Hidden: ${selectedObject}`);
            }
        }

        function deleteSelected() {
            if (selectedObject) {
                history.push(selectedObject);
                // Placeholder: Delete object
                alert(`Deleted: ${selectedObject}`);
            }
        }

        function undo() {
            if (history.length > 0) {
                const obj = history.pop();
                // Placeholder: Restore object
                alert(`Restored: ${obj}`);
            }
        }

        // Watchlist functions
        document.getElementById('watchlistFilter').addEventListener('input', function() {
            const filter = this.value.toLowerCase();
            const items = document.querySelectorAll('.list-group-item');
            items.forEach(item => {
                item.style.display = item.textContent.toLowerCase().includes(filter) ? '' : 'none';
            });
        });

        function addToWatchlist() {
            const symbol = prompt('Enter symbol:');
            if (symbol) {
                const list = document.querySelector('#watchlists .list-group');
                const item = document.createElement('li');
                item.className = 'list-group-item d-flex justify-content-between align-items-center';
                item.innerHTML = `${symbol} <span class="badge bg-secondary">New</span>`;
                list.appendChild(item);
            }
        }

        // Init first chart
        Plotly.newPlot('chart1', [{x: [1,2,3], y: [1,2,3], type: 'scatter'}]);
    </script>
</body>
</html>